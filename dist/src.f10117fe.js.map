{"version":3,"sources":["src/index.ts"],"names":[],"mappings":"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","file":"src.f10117fe.js","sourceRoot":"..","sourcesContent":["function startVideoStream() {\n  if (!navigator.mediaDevices.getUserMedia) return;\n  navigator.mediaDevices\n    .getUserMedia({ audio: false, video: { facingMode: \"user\" } })\n    .then(function(stream) {\n      const video: HTMLVideoElement = document.querySelector(\"#webcam\");\n      video.srcObject = stream;\n      video.onloadedmetadata = function(e) {\n        video.play();\n      };\n      startTesting(video);\n    })\n    .catch(function(err) {\n      alert(\n        \"An error has occurred loading your webcam feed. Try again, or maybe in a different browser?\"\n      );\n    });\n}\n\nlet testingTimeout: number;\nlet timerTimeout: number;\nlet secondsSinceLastTouch = 0;\n\nfunction startTesting(video: HTMLVideoElement, interval: number = 500) {\n  const title = document.getElementById(\"header\");\n  const time = document.getElementById(\"time\");\n\n  const loop = async () => {\n    const blob = await captureFrame(video);\n    const isTouching = await checkFaceTouching(blob);\n\n    if (isTouching) {\n      const audio = new Audio(\"https://uploads.lazerwalker.com/honk.mp3\");\n      audio.play();\n      document.body.classList.add(\"touching\");\n      title.innerText = \"⚠️ YOU ARE TOUCHING YOUR FACE ⚠️\";\n      secondsSinceLastTouch = -1;\n    } else {\n      document.body.classList.remove(\"touching\");\n      title.innerText = \"Don't Touch Your Face!\";\n    }\n\n    testingTimeout = setTimeout(loop, interval);\n  };\n\n  const timerLoop = () => {\n    secondsSinceLastTouch += 1;\n    const minutes = Math.floor(secondsSinceLastTouch / 60);\n    const seconds = ((secondsSinceLastTouch % 60).toString() as any).padStart(\n      2,\n      \"0\"\n    );\n    time.innerText = `${minutes}:${seconds}`;\n    timerTimeout = setTimeout(timerLoop, 1000);\n  };\n\n  loop();\n  timerLoop();\n}\n\nfunction stopTesting() {\n  clearTimeout(testingTimeout);\n  clearTimeout(timerTimeout);\n}\n\nasync function checkFaceTouching(blob: Blob): Promise<boolean | undefined> {\n  const json = await imagePrediction(blob);\n  if (!json.predictions) return undefined;\n\n  const touching = json.predictions.find(p => p.tagName === \"touching-face\");\n  if (!touching) return undefined;\n\n  return touching.probability > 0.1;\n}\n\nasync function imagePrediction(blob: Blob): Promise<any> {\n  const response = await fetch(\n    \"https://eastus.api.cognitive.microsoft.com/customvision/v3.0/Prediction/4e0b5b08-57cc-4e4f-ad70-a868b1ba70ad/classify/iterations/Iteration1/image\",\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/octet-stream\",\n        \"Prediction-Key\": \"ce04b2c466a64e748584aa72f53415e6\"\n      },\n      body: blob\n    }\n  );\n  return await response.json();\n}\n\nasync function captureFrame(video: HTMLVideoElement): Promise<Blob> {\n  return new Promise((resolve, reject) => {\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = 640;\n    canvas.height = 480;\n    var ctx = canvas.getContext(\"2d\");\n\n    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n    //   return canvas.toDataURL(\"image/jpeg\");\n\n    canvas.toBlob(blob => {\n      resolve(blob);\n    }, \"image/jpeg\");\n  });\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  startVideoStream();\n});\n"]}